# 1 什么是CORS？
CORS是Cross-Origin Resource Sharing的缩写，意思是**跨域资源共享**。
本质上，CORS是HTTP协议对**浏览器**中**不同网站**间**AJAX请求**的规范和限制。
Web世界里有无数个网站，每个网站都有自己的”门牌号“：`协议://域名:端口`。
网站本质上只是部署在服务器某个端口上的应用进程。
网站通过监听端口来接收外界的访问。外界通过域名（IP地址）来找到对应服务器，通过协议/端口来找到对应应用进程。
因此，协议/域名/端口可以定位网站在哪一个服务器，哪一个端口上。这三个只要有一个不同，说明该应用程序是不同的进程，就是不同的网站。
而跨域指的就是跨越网站。
当网站A想要通过AJAX请求获取网站B的数据（资源）时，就会发生跨域请求。因为它们是不同进程，不能保证对方的安全性。
如同陌生人想去你家拿东西或者放东西，楼下保安必须校验陌生人的身份信息。
浏览器就是Web世界里的保安，它根据CORS协议来核实AJAX请求是否被目标网站所允许。
```plantuml
A -> 浏览器 : AJAX请求
浏览器 -> 浏览器 : CORS预处理
浏览器 -> B : HTTP请求
B -> 浏览器 : HTTP响应
浏览器 -> 浏览器 : CORS校验
浏览器 -> A : AJAX响应
```
# 2 如何辨别跨域请求？
浏览器会为每个AJAX请求添加以下请求头：
- Host：目标网站的“门牌号”
- Origin：当前网站的“门牌号”
例如，我们在`https://www.baidu.com/`网站打开控制台，输入以下代码：
```
fetch("http://localhost:8080")
```
这次请求的两个请求头为：
```
Host: localhost:8080
Origin: https://www.baidu.com
```
当`Host`和`Origin`不一致时，浏览器就判断这个是跨域请求，它就会根据CORS协议采取一定的校验措施。
# 3 CORS校验流程


需要注意的是，CORS协议只是一个规范，不同浏览器对它的实现可能不同。