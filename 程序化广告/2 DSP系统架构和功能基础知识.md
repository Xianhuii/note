# 1 整体架构

DSP一般有四大系统模块：竞价系统、策略系统、预警监控系统和资源管理系统，核心是竞价和策略，策略是竞价的约束条件，每个系统下面有多个子系统。

![[Pasted image 20241101095505.png]]

# 2 系统组成

## 2.1 竞价系统

竞价系统的作用是帮助广告主在RTB市场上进行广告流量精准竞价采买和展示。

这些决策是毫秒级的，并且每秒需要处理的流量数以万计。DSP只要接入足够度多ADX，那么能得到的竞价请求基本是按十亿级别计算的。

因为市面上有很多的ADX，每一家的格式，传递的数据结果可能都不一样。适配器，这个的作用是将不同ADX的竞价请求转化为统一的、可被识别的格式。

处理器对接策略系统和预警监控系统，依据用户预先设置以及算法优化配置的广告策略，对竞价请求进行处理，决策是否出价、出价价格、内部竞价筛选等。

![[Pasted image 20241101095524.png]]

## 2.2 策略系统

策略是广告主做的一系列投放设置，通过设置实现受众定向，优化广告投放效果、提升广告效益的地方，在众多的人流中找到最有价值的流量进行采买和展示，实现精准投放，从而优化投放效果。

ADX的竞价请求往往会尽可能的将用户的特征信息、行为信息附着到竞价请求中，以便DSP竞价系统根据广告策略系统，判断是否符合决策、是否出价、出价价格、广告内容等。

不同平台对策略的分类不同，有的分为基本设置、高级设置、媒体设置和创意设置，如：

![[Pasted image 20241101095535.png]]

## 2.3 预警监控系统

互联网上问题流量泛滥，投放的过程中可能出现各种各样的问题，需要通过数据及时进行调整优化，这就需要预警监控系统。

### 2.3.1 预警系统

对数据出现较大波动或超过一定阈值的之后自动采取一定的应对机制，如可能是短信通知相关人员，自动暂停投放，自动降价等。

预警系统是一个很大的工程，需要多个投放过程的关键环节都做预警监控的，最简单的就是用户的DSP账户还没钱了，需要做预警提示用户，避免影响广告的投放。

有些预警甚至有分析的能力，这个需要在分析逻辑上处理好，如某个数据数据异常，被预警系统监控到，根据分析逻辑处理，分析列出最有可能的几个原因，用户直接去验证后就可以做决策。

### 2.3.2 反作弊系统

广告作弊是数字广告的一个常态，是影响业界所有人的一个难题，有流量的地方，就有作弊的动机，也存在作弊广告，完全消除作弊广告是没可能的，反作弊不是一个技术问题，而是一个成本问题，广告平台能做的就是尽量降低作弊带来的损失，所有的投放平台都会有反作弊的模块或系统，通过分析大量的数据，找到异常行为的算法，开展发作弊工作。

反作弊有两个方向一个是基于规则统计，一个是基于机器学习，规则统计的优点是好解释，缺点是规则统计通常是基于业务，能够找到的特征有限；机器学习可以实现很复杂的逻辑，但是解释性较差。

规则可以做的很复杂的，如某二线互联网公司反作弊系统中运行的总规则数达到了1万+。

### 2.3.3 第三方跟踪验证

因为利益冲突，广告主对广告平台提供的数据持保留态度，希望通过独立第三方的数据去验证，这就需要DSP平台能对接广告服务提供商，如广告监测的反作弊、品牌安全、可视度等。

第三方跟踪验证已经成为DSP平台的标配，部分DSP平台为了消除广告主的顾虑，在广告主投放的过程中，免费提供第三方监测分析报告。

## 2.4 资源管理系统

资源管理系统主要涉及用户、数字资产、数据、财务在内的多方面资源管理，保证程序化购买有序进行。

![[Pasted image 20241101095624.png]]

# 3 竞价流程

![[Pasted image 20241101095640.png]]

## 3.1 竞价请求

ADX发起竞价请求，其中会包含用户和广告等信息。

## 3.2 解析请求

DSP会对接不同ADX的不同竞价请求协议，需要通过适配器解析请求，处理成内部统一的格式，进行后续竞价处理。

## 3.3 过滤

出于不同需求，需要对竞价请求进行过滤：

1. 黑名单：对于质量不好的流量（花费高、转化低），可以加入黑名单进行选择性过滤。
    
2. 流量控制：流量洪峰控制，对流量做控制，避免服务器过载。
    

## 3.4 预处理

从解析的请求里面处理一些特征，如广告位特征，广告主特征，方便后续的计算或筛选定位。

## 3.5 用户识别

从解析的请求里提取用户特征：

1. Match Table中查找cookie
    
    1. 存在：去用户中心查询用户特征
        
    2. 不存在：cookie mapping
        

## 3.6 匹配广告

用前面获取的用户特征，根据广告主在DSP上设置的时间，预算，用户类型，频次控制等投放策略做匹配，决定DSP内部广告主是否出价，如果符合要求就参与DSP内部竞价，如果不符合就放弃。

## 3.7 出价

简单来说，就是通过算法计算出广告的竞价价格。

## 3.8 内部竞价筛选

前面处理完成后可能得到多个广告，需要先在内部进行筛选，选取价格最高的进行响应。

## 3.9 解析响应

对不同的ADX，需要通过适配器封装对应格式的响应进行返回。

参考资料：

1. [程序化广告生态圈(12)——DSP的系统构成 | GA小站](https://www.ichdata.com/dsp-system-composition.html)
    
2. [程序化广告生态圈(13)——DSP中的竞价流程 | GA小站](https://www.ichdata.com/dsp-bidding-process.html)
    
3. [www.iab.com](https://www.iab.com/wp-content/uploads/2016/03/OpenRTB-API-Specification-Version-2-5-FINAL.pdf)